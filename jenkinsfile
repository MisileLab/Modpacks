
pipeline {
  agent { label "node" }
  stages {
    stage('BasicCraft') {
      when { anyOf { changeset "modpacks/BasicCraft/mods/*.jar" } }
      steps {
        dir('modpacks') {
          sh "/home/kakao9992/7zip/7zz a -t7z basiccraft.7z BasicCraft/mods/*"
        }
      }
    }
    stage('SomeMechanics') {
      when { anyOf { changeset "modpacks/SomeMechanics/mods/*.jar"} }
      steps {
        dir('modpacks') {
          sh "/home/kakao9992/7zip/7zz a -t7z somemechaincs.7z SomeMechanics/mods/*"
        }
      }
    }
    stage('Artifact archive') {
      steps {
        script {
          if (!fileExists('basiccraft.7z')) {
            sh (
              script: 'wget https://jenkins.misilelaboratory.xyz/job/modpack-build/lastSuccessfulBuild/artifact/basiccraft.7z > /dev/null',
              returnStdout: false
            )
          }
          if (!fileExists('somemechanics.7z')) {
            sh (
              script: 'wget https://jenkins.misilelaboratory.xyz/job/modpack-build/lastSuccessfulBuild/artifact/somemechaincs.7z > /dev/null',
              returnStdout: false
            )
          }
          archiveArtifacts 'basiccraft.7z'
          archiveArtifacts 'somemechaincs.7z'
        }
      }
    }
  }
}
